# Cloud Computing

## Виртуальная машина (ВМ, VM)

Сервера в YaCLoud

Группа виртуальных машин (Instance Groups) — группа однотипных ВМ. Легче управлять ими, чем большим количеством обычных ВМ. Все ВМ в группе создаются автоматически по шаблону. В пик ВМ добавятся, в спад — погасятся, в случае сбоя — перезапустятся.

Создание, обновление и удаление ВМ в группах выполняется от имени так называемого [сервисного аккаунта](https://cloud.yandex.ru/docs/iam/concepts/users/service-accounts). Это учетная запись со специфичным набором привилегий (например, административным). Группе ВМ можно присвоить только один сервисный аккаунт, созданный в том же самом каталоге.

## COM: Последовательный порт

Если случился сбой, и подключиться по SSH/RDP не получается, для диагностики можно использовать последовательный порт для доступа к ВМ:

![](<../../.gitbook/assets/изображение (1).png>)

Здесь можно посмотреть историю команд (поиск Ctrl-F в режиме Исходные данные)

COM1 — Linux

COM2 — Windows

## Серийная консоль

Если включена у ВМ режим серийной консоли, то через последовательный порт можно аутентифицироваться на тачку и что-то поделать. Перед этим предварительно надо зайти на машину по SSH и задать пользователю пароль:

```
sudo passwd <имя_пользователя> 
```

Подключиться к консоли можно по SSH, Yandex Cloud Web и CLI. Для SSH и YC CLI нужна знать ID серийной консоли (можно в списке ВМ узнать)

### Подключение через SSH

```
ssh -t -p 9600 -o IdentitiesOnly=yes -i ~/.ssh/<имя закрытого ключа> <ID виртуальной машины>.<имя пользователя>@serialssh.cloud.yandex.net
```

Например:

```
ssh -t -p 9600 -o IdentitiesOnly=yes -i ~/.ssh/id_rsa fhm0b28lgfp4tkoa3jl6.yc-user@serialssh.cloud.yandex.net
```

Чтобы отключиться от серийной консоли, нажмите клавишу `Enter`, а затем введите символы `~.` (тильда и точка). В терминалах Linux для отключения также можно использовать комбинацию клавиш **Ctrl + D**.

## Сервис метаданных и cloud-init

С каждой ВМ в Compute Cloud связаны метаданные. Метаданные  — это идентификатор, название и описание ВМ, список подключённых к ней дисков и сетевых интерфейсов, привязанные к ВМ сервисные аккаунты. Кроме того, вы можете определять дополнительные метаданные и указывать их, когда создаёте или изменяете ВМ.

Получайте метаданные изнутри ВМ с помощью сервиса метаданных (он доступен из любой ВМ по адресу [http://169.254.169.254](http://169.254.169.254/)) и используйте их для настройки машины или софта на ней. Например, укажите через метаданные, в каком режиме запуститься приложению на сервере: в отладочном или в боевом. Меняйте режим, не заходя на сервер, просто меняя значение в сервисе метаданных.

Сервис возвращает метаданные в двух форматах: Google Compute Engine или Amazon EC2.

В ВМ на базе Linux для работы с метаданными, как правило, используется агент [cloud-init](https://cloud-init.io/), в машинах с Windows — [Cloudbase-Init](https://cloudbase.it/cloudbase-init/). Но вы можете отправить запрос в сервис метаданных и самостоятельно — с помощью любого HTTP-клиента.

Вы можете передать метаданные при создании и изменении ВМ. Чаще всего это делается с помощью консольной утилиты Yandex Cloud CLI, о которой мы подробно расскажем позже.

Указывайте метаданные в CLI в одном из трёх параметров:

* \--metadata принимает список пар «ключ=значение», разделённых запятой, например:  --metadata foo1=bar,foo2=baz.
* \-metadata-from-file читает метаданные из файла, например:  -metadata-from-file key=path/to/file. Этот метод удобен, чтобы передавать длинные метаданные.
* \-ssh-key — специальный тип метаданных для хранения публичного SSH-ключа. Доступен только для ВМ на Linux, где его читает агент cloud-init.
